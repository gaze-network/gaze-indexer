// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.26.0
// source: data.sql

package gen

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const createProcessorStats = `-- name: CreateProcessorStats :exec
INSERT INTO "brc20_processor_stats" (block_height, cursed_inscription_count, blessed_inscription_count, lost_sats) VALUES ($1, $2, $3, $4)
`

type CreateProcessorStatsParams struct {
	BlockHeight             int32
	CursedInscriptionCount  int32
	BlessedInscriptionCount int32
	LostSats                int64
}

func (q *Queries) CreateProcessorStats(ctx context.Context, arg CreateProcessorStatsParams) error {
	_, err := q.db.Exec(ctx, createProcessorStats,
		arg.BlockHeight,
		arg.CursedInscriptionCount,
		arg.BlessedInscriptionCount,
		arg.LostSats,
	)
	return err
}

const getInscriptionEntriesByIds = `-- name: GetInscriptionEntriesByIds :many
WITH "states" AS (
  -- select latest state
  SELECT DISTINCT ON ("id") id, block_height, transfer_count FROM "brc20_inscription_entry_states" WHERE "id" = ANY($1::text[]) ORDER BY "id", "block_height" DESC
)
SELECT brc20_inscription_entries.id, number, sequence_number, delegate, metadata, metaprotocol, parents, pointer, content, content_encoding, content_type, cursed, cursed_for_brc20, created_at, created_at_height, states.id, block_height, transfer_count FROM "brc20_inscription_entries"
  LEFT JOIN "states" ON "brc20_inscription_entries"."id" = states."id"
  WHERE "brc20_inscription_entries"."id" = ANY($1::text[])
`

type GetInscriptionEntriesByIdsRow struct {
	Id              string
	Number          int64
	SequenceNumber  int64
	Delegate        pgtype.Text
	Metadata        []byte
	Metaprotocol    pgtype.Text
	Parents         []string
	Pointer         pgtype.Int8
	Content         []byte
	ContentEncoding pgtype.Text
	ContentType     pgtype.Text
	Cursed          bool
	CursedForBrc20  bool
	CreatedAt       pgtype.Timestamp
	CreatedAtHeight int32
	Id_2            pgtype.Text
	BlockHeight     pgtype.Int4
	TransferCount   pgtype.Int4
}

func (q *Queries) GetInscriptionEntriesByIds(ctx context.Context, inscriptionIds []string) ([]GetInscriptionEntriesByIdsRow, error) {
	rows, err := q.db.Query(ctx, getInscriptionEntriesByIds, inscriptionIds)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetInscriptionEntriesByIdsRow
	for rows.Next() {
		var i GetInscriptionEntriesByIdsRow
		if err := rows.Scan(
			&i.Id,
			&i.Number,
			&i.SequenceNumber,
			&i.Delegate,
			&i.Metadata,
			&i.Metaprotocol,
			&i.Parents,
			&i.Pointer,
			&i.Content,
			&i.ContentEncoding,
			&i.ContentType,
			&i.Cursed,
			&i.CursedForBrc20,
			&i.CreatedAt,
			&i.CreatedAtHeight,
			&i.Id_2,
			&i.BlockHeight,
			&i.TransferCount,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getInscriptionsInOutPoint = `-- name: GetInscriptionsInOutPoint :many
SELECT inscription_id, block_height, old_satpoint_tx_hash, old_satpoint_out_idx, old_satpoint_offset, new_satpoint_tx_hash, new_satpoint_out_idx, new_satpoint_offset, new_pkscript, new_output_value, sent_as_fee FROM "brc20_inscription_transfers" WHERE "new_satpoint_tx_hash" = $1 AND "new_satpoint_out_idx" = $2
`

type GetInscriptionsInOutPointParams struct {
	TxHash   pgtype.Text
	TxOutIdx pgtype.Int4
}

func (q *Queries) GetInscriptionsInOutPoint(ctx context.Context, arg GetInscriptionsInOutPointParams) ([]Brc20InscriptionTransfer, error) {
	rows, err := q.db.Query(ctx, getInscriptionsInOutPoint, arg.TxHash, arg.TxOutIdx)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Brc20InscriptionTransfer
	for rows.Next() {
		var i Brc20InscriptionTransfer
		if err := rows.Scan(
			&i.InscriptionID,
			&i.BlockHeight,
			&i.OldSatpointTxHash,
			&i.OldSatpointOutIdx,
			&i.OldSatpointOffset,
			&i.NewSatpointTxHash,
			&i.NewSatpointOutIdx,
			&i.NewSatpointOffset,
			&i.NewPkscript,
			&i.NewOutputValue,
			&i.SentAsFee,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getLatestProcessorStats = `-- name: GetLatestProcessorStats :one
SELECT block_height, cursed_inscription_count, blessed_inscription_count, lost_sats FROM "brc20_processor_stats" ORDER BY block_height DESC LIMIT 1
`

func (q *Queries) GetLatestProcessorStats(ctx context.Context) (Brc20ProcessorStat, error) {
	row := q.db.QueryRow(ctx, getLatestProcessorStats)
	var i Brc20ProcessorStat
	err := row.Scan(
		&i.BlockHeight,
		&i.CursedInscriptionCount,
		&i.BlessedInscriptionCount,
		&i.LostSats,
	)
	return i, err
}
